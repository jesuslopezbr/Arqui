
4. Explique c´omo ha conseguido resolver algunas de las principales cuestiones en C++)¡: creaci´on y
gesti´on de arrays, strings (o char *), entrada/salida, etc.


Compilación:

No hemos tenido problemas compilando con estas dos lineas en las maquinas de Telemática.

gcc -c controlclientes.cpp
gcc -o <Nombre de programa> controlclientes.o -lstdc++ -pthread

Si encuentras fallos a la hora de compilar estas dos lineas son la alternativa que se puede usar para compilar.

gcc-4.9 -c controlclientes.cpp
gcc-4.9 -o <Nombre de programa> controlclientes.o -lstdc++ -pthread

Ejecución:

./<Nombre de programa> <Tiempo de actualizar_desc>

Prototipos:

En nuestros prototipos no ha hecho falta la entrada de variables ni el retorno de ninguna de ellas por el uso de variables globales. En los prototipos de facturacion y actualizar_desc usamos la entrada void time para actualizar el descuento cada cierto tiempo especificado

void menu();

void imprimir_datos_c1();

void clear_fail_state();

Este método sirve para limpiar la entrada de usuario cada vez que se introduzca un caracter inválido

void alta_usr();

void baja_usr();

void cambiar_tarifa();

void *actualizar_desc(void * time);

void *facturacion(void * time);

void terminar();

int main (int argc, char *argv[]);

Esquema de hebras, sincronizacion y comunicaci´on entre ellas:

Hemos usado dos hebras, h_desc y h_factura, que usamos para la ejecución del método facturación y actualizar_desc.
Creamos la hebra h_desc en el main al pulsar el boton '5' y la hebra h_factura en el metodo actualizar_desc a partir de la hebra h_desc.
Para la sincronización hemos usado dos mutex y una condición, el mutex "clients_mutex" sirve para proteger los datos de los usuarios que tenemos en el array datos_c1. El otro mutex llamado loop_mutex es para proteger la variable "loop" que se usa para salir del loop en las hebras cuando se finaliza el programa.
Para la comunicación la condición que hemos usado es "cambio_desc" y lo usamos cuando detectamos un cambio en el descuento de los clientes, ya sea por ajuste del descuento, por el alta o por la baja de un usuario. Cuando lo detecta manda una señal que es recibida por la condicion de espera que hay en el metodo de facturación
Hemos usado estas librerias:
- pthread.h para el manejo y creacion de threads y mutexes.
- unistd.h para la llamada al sistema de usleep() que sirve para dormir el thread un tiempo determinado..
- string.h para poder declarar strings dentro del programa en vez de usar char *.
- iostream y stdio.h para la entrada y salida de pantalla.
